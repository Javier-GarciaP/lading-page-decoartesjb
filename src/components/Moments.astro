---
import Section from "./Section.astro";
---

<Section title="Momentos Inolvidables">
  <section class="relative w-full py-10 overflow-hidden">
    <!-- Decorative background elements -->
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-4xl h-96 bg-primary/20 blur-[120px] rounded-full z-0 opacity-20 pointer-events-none"></div>

    <div class="carousel-3d-container relative w-full max-w-5xl mx-auto h-[500px] perspective-1000 flex items-center justify-center z-10">
      
      <!-- Navigation Buttons -->
      <button class="nav-btn prev absolute left-4 md:-left-8 z-50 p-3 rounded-full bg-white/5 border border-white/10 text-white hover:bg-primary hover:border-primary transition-all duration-300 backdrop-blur-sm" onclick="moveCarousel(-1)">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
        </svg>
      </button>

      <button class="nav-btn next absolute right-4 md:-right-8 z-50 p-3 rounded-full bg-white/5 border border-white/10 text-white hover:bg-primary hover:border-primary transition-all duration-300 backdrop-blur-sm" onclick="moveCarousel(1)">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
        </svg>
      </button>

      <!-- Carousel Track -->
      <div id="track" class="relative w-full h-full flex items-center justify-center transform-style-3d transition-transform duration-700 ease-out">
        {
          [
            "imagen-1.jpg",
            "imagen-2.jpg",
            "imagen-3.jpg",
            "imagen-4.jpg",
            "imagen-5.jpg"
          ].map((img, index) => (
            <div
              class="card absolute w-[300px] md:w-[400px] h-[450px] bg-cover bg-center rounded-2xl shadow-2xl transition-all duration-700 ease-out cursor-pointer border border-white/10"
              style={`background-image: url('eventos-carrusel/${img}')`}
              data-index={index}
            >
              <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent rounded-2xl opacity-60 group-hover:opacity-40 transition-opacity duration-300"></div>
              
              <!-- Reflection effect -->
              <div class="absolute -bottom-[20px] left-0 right-0 h-[20px] bg-gradient-to-t from-primary/20 to-transparent blur-sm transform scale-y-[-1] opacity-30"></div>
            </div>
          ))
        }
      </div>
    </div>

    <!-- CTA -->
    <div class="flex justify-center mt-16 relative z-10">
        <a
        href="/galery"
        class="px-8 py-4 bg-transparent border border-zinc-700 text-white font-heading text-lg rounded-full hover:bg-white hover:text-black transition-all duration-300 shadow-lg tracking-wide hover:scale-105"
      >
        Ver Galer√≠a Completa
      </a>
    </div>
  </section>
</Section>

<style>
  .perspective-1000 {
    perspective: 1000px;
  }
  .transform-style-3d {
    transform-style: preserve-3d;
  }
  .card {
     /* Initial positions handled by JS */
     backface-visibility: hidden;
  }
</style>

<script is:inline>
  let activeIndex = 2; // Center initial slide
  const cards = document.querySelectorAll('.card');
  const count = cards.length;

  function updateCarousel() {
    cards.forEach((card, i) => {
      const offset = i - activeIndex;
      const absOffset = Math.abs(offset);
      
      let transform = '';
      let zIndex = 0;
      let opacity = 1;
      let pointerEvents = 'auto';

      if (offset === 0) {
        // Active card
        transform = `translateX(0) translateZ(200px) rotateY(0deg)`;
        zIndex = 20;
      } else if (absOffset === 1) {
        // Neighbors
        transform = `translateX(${offset * 250}px) translateZ(0px) rotateY(${offset * -15}deg)`;
        zIndex = 10;
        opacity = 0.8;
      } else {
        // Far cards
        transform = `translateX(${offset * 200}px) translateZ(-200px) rotateY(${offset * -30}deg)`;
        zIndex = 5;
        opacity = 0.5;
        pointerEvents = 'none';
      }

      // Responsive adjustments
      if (window.innerWidth < 768) {
          if (offset === 0) transform = `translateX(0) translateZ(100px) rotateY(0deg) scale(0.9)`;
          else transform = `translateX(${offset * 120}px) translateZ(-100px) rotateY(${offset * -10}deg) scale(0.8)`;
      }

      card.style.transform = transform;
      card.style.zIndex = zIndex;
      card.style.opacity = opacity;
      card.style.pointerEvents = pointerEvents;
    });
  }

  window.moveCarousel = (direction) => {
    activeIndex += direction;
    if (activeIndex < 0) activeIndex = count - 1;
    if (activeIndex >= count) activeIndex = 0;
    updateCarousel();
  }

  // Click on card to center
  cards.forEach((card, index) => {
      card.addEventListener('click', () => {
          activeIndex = index;
          updateCarousel();
      });
  });

  // Auto-rotate
  let autoRotate = setInterval(() => moveCarousel(1), 4000);
  
  // Pause on hover
  document.querySelector('.carousel-3d-container').addEventListener('mouseenter', () => clearInterval(autoRotate));
  document.querySelector('.carousel-3d-container').addEventListener('mouseleave', () => {
      autoRotate = setInterval(() => moveCarousel(1), 4000);
  });

  updateCarousel();
  window.addEventListener('resize', updateCarousel);
</script>
