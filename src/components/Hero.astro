---
const { title: titulo } = Astro.props;
const hayTitulo = titulo ? true : false;
import MagneticButton from "./effects/MagneticButton.astro";
---

<header class="relative w-full min-h-[70vh] flex flex-col justify-between overflow-hidden">
  <!-- Animated 3D Background -->
  <div class="absolute inset-0 z-0 select-none overflow-hidden">
    <!-- Dark Overlay -->
    <div class="absolute inset-0 bg-gradient-to-b from-bg/90 via-bg/85 to-bg z-20"></div>
    
    <!-- Background Image -->
    <img
      src="/fondo.jpg"
      alt="Hero Background"
      class="w-full h-full object-cover opacity-20 animate-slow-zoom"
    />

    <!-- 3D Canvas Container -->
    <canvas id="decoration-canvas" class="absolute inset-0 z-10"></canvas>
  </div>

  <!-- Floating Decorative Elements -->
  <div class="absolute inset-0 z-10 pointer-events-none overflow-hidden">
    <!-- Animated Particles -->
    <div id="particles-hero" class="absolute inset-0"></div>
    
    <!-- Floating Orbs -->
    <div class="absolute top-20 left-10 w-64 h-64 bg-primary/10 rounded-full blur-3xl animate-float-slow"></div>
    <div class="absolute bottom-20 right-20 w-80 h-80 bg-amber-500/10 rounded-full blur-3xl animate-float-slower"></div>
    <div class="absolute top-1/3 right-1/4 w-48 h-48 bg-yellow-500/10 rounded-full blur-2xl animate-float-medium"></div>
  </div>

  <!-- Minimalist Navbar -->
  <nav
    class="fixed top-0 w-full z-50 transition-all duration-300 glass border-b border-white/5"
  >
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
      <a href="/" class="z-50 group">
        <span
          class="font-heading font-black text-2xl text-white tracking-tighter"
        >
          DECOARTES<span class="bg-gradient-to-r from-primary to-amber-400 bg-clip-text text-transparent">JB</span>
        </span>
      </a>

      <!-- Desktop Menu -->
      <ul
        class="hidden lg:flex items-center gap-8 font-body text-sm font-medium"
      >
        <li>
          <a
            href="/#sobre-mi"
            class="text-secondary hover:text-primary transition-colors"
            >Nosotros</a
          >
        </li>
        <li>
          <a
            href="/#process"
            class="text-secondary hover:text-primary transition-colors"
            >Proceso</a
          >
        </li>
        <li>
          <a
            href="/gallery"
            class="text-secondary hover:text-primary transition-colors"
            >Portafolio</a
          >
        </li>
        <li>
          <a
            href="/#opiniones"
            class="text-secondary hover:text-primary transition-colors"
            >Testimonios</a
          >
        </li>
        <li>
          <a
            href="/#contact"
            class="px-5 py-2.5 bg-gradient-to-r from-primary to-amber-400 text-white font-bold rounded-lg hover:shadow-lg hover:shadow-primary/30 transition-all transform hover:scale-105"
          >
            Consulta
          </a>
        </li>
      </ul>

      <!-- Mobile Menu Button -->
      <button id="mobile-menu-btn" class="lg:hidden text-white p-2 z-50">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          ><line x1="3" y1="12" x2="21" y2="12"></line><line
            x1="3"
            y1="6"
            x2="21"
            y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg
        >
      </button>
    </div>
  </nav>

  <!-- Mobile Menu Overlay -->
  <div
    id="mobile-menu"
    class="fixed inset-0 bg-bg/95 backdrop-blur-3xl z-40 hidden flex flex-col items-center justify-center gap-8 opacity-0 transition-opacity duration-300"
  >
    <a
      href="/#sobre-mi"
      class="text-2xl text-white font-light hover:text-primary transition-colors"
      onclick="toggleMenu()">Nosotros</a
    >
    <a
      href="/#proceso"
      class="text-2xl text-white font-light hover:text-primary transition-colors"
      onclick="toggleMenu()">Proceso</a
    >
    <a
      href="/gallery"
      class="text-2xl text-white font-light hover:text-primary transition-colors"
      onclick="toggleMenu()">Portafolio</a
    >
    <a
      href="/#contact"
      class="text-2xl font-bold bg-gradient-to-r from-primary to-amber-400 text-white px-8 py-3 rounded-full"
      onclick="toggleMenu()">Consulta</a
    >
  </div>

  <!-- Hero Content -->
  <div
    class="relative z-30 flex-grow flex flex-col justify-center items-center text-center px-6 pt-20 pb-12 max-w-5xl mx-auto"
  >
    {
      hayTitulo ? (
        <h1 class="font-heading text-3xl md:text-5xl font-bold text-white mb-6 animate-fade-in-up">
          {titulo}
        </h1>
      ) : (
        <>
          <div class="animate-fade-in-up">
            <span class="inline-flex items-center gap-2 py-2 px-4 rounded-full border border-primary/30 bg-primary/10 backdrop-blur-sm text-sm font-bold tracking-widest text-primary mb-6">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
              DESDE 2009
            </span>
          </div>

          <h1 class="font-heading text-3xl md:text-5xl lg:text-6xl font-black text-white mb-6 tracking-tight leading-none animate-fade-in-up delay-100">
            Creamos Momentos <br class="hidden md:block" />
            <span class="bg-gradient-to-r from-primary via-amber-300 to-yellow-400 bg-clip-text text-transparent animate-gradient">
              Inolvidables
            </span>
          </h1>

          <p class="text-secondary text-lg md:text-xl max-w-2xl mx-auto mb-10 leading-relaxed font-light animate-fade-in-up delay-200">
            Transformamos espacios con un diseño elegante y sofisticado.
            Especialistas en bodas y eventos corporativos de alto nivel en
            Santiago.
          </p>

          <div class="flex flex-col sm:flex-row items-center gap-4 animate-fade-in-up delay-300">
            <MagneticButton
              href="/#contact"
              text="Agendar Cita"
              variant="primary"
              class="w-full sm:w-auto uppercase tracking-wider shadow-[0_0_20px_rgba(212,175,55,0.4)]"
            />
            <MagneticButton
              href="/galery"
              text="Ver Galería"
              variant="secondary"
              class="w-full sm:w-auto uppercase tracking-wider"
            />
          </div>

          <!-- Stats Preview -->
          <div class="grid grid-cols-3 gap-8 mt-16 max-w-2xl mx-auto animate-fade-in-up delay-400">
            <div class="text-center">
              <div class="text-2xl md:text-3xl font-bold text-primary mb-1">500+</div>
              <div class="text-xs md:text-sm text-secondary uppercase tracking-wider">Eventos</div>
            </div>
            <div class="text-center border-x border-white/10">
              <div class="text-2xl md:text-3xl font-bold text-primary mb-1">15+</div>
              <div class="text-xs md:text-sm text-secondary uppercase tracking-wider">Años</div>
            </div>
            <div class="text-center">
              <div class="text-2xl md:text-3xl font-bold text-primary mb-1">98%</div>
              <div class="text-xs md:text-sm text-secondary uppercase tracking-wider">Satisfacción</div>
            </div>
          </div>
        </>
      )
    }
  </div>

  <!-- Scroll Down Indicator -->
  <div class="relative z-30 pb-8 flex justify-center animate-bounce">
    <a
      href="#sobre-mi"
      class="flex flex-col items-center gap-2 text-secondary hover:text-primary transition-colors group"
    >
      <span class="text-xs uppercase tracking-widest">Descubre más</span>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="group-hover:translate-y-1 transition-transform"
        ><path d="M7 13l5 5 5-5M7 6l5 5 5-5"></path></svg
      >
    </a>
  </div>
</header>

<script>
  // 3D Decoration Animation
  class DecorationScene {
    private canvas: HTMLCanvasElement;
    private ctx!: CanvasRenderingContext2D;
    private elements: DecoElement[] = [];
    private animationId: number = 0;

    constructor(canvasId: string) {
      this.canvas = document.getElementById(canvasId) as HTMLCanvasElement;
      if (!this.canvas) return;

      this.ctx = this.canvas.getContext("2d")!;
      this.resize();
      this.init();
      this.animate();

      window.addEventListener("resize", () => this.resize());
    }

    resize() {
      this.canvas.width = window.innerWidth;
      this.canvas.height = window.innerHeight;
    }

    init() {
      const shapes = ["balloon", "flower", "star", "heart", "diamond"];
      const count = 15;

      for (let i = 0; i < count; i++) {
        this.elements.push({
          x: Math.random() * this.canvas.width,
          y: Math.random() * this.canvas.height,
          size: Math.random() * 30 + 20,
          rotation: Math.random() * Math.PI * 2,
          rotationSpeed: (Math.random() - 0.5) * 0.02,
          vx: (Math.random() - 0.5) * 0.5,
          vy: (Math.random() - 0.5) * 0.5,
          shape: shapes[Math.floor(Math.random() * shapes.length)],
          opacity: Math.random() * 0.3 + 0.1,
          scale: 1,
          targetScale: 1,
        });
      }
    }

    drawBalloon(x: number, y: number, size: number, rotation: number, opacity: number) {
      this.ctx.save();
      this.ctx.translate(x, y);
      this.ctx.rotate(rotation);
      this.ctx.globalAlpha = opacity;

      // Balloon
      this.ctx.beginPath();
      this.ctx.ellipse(0, 0, size * 0.6, size * 0.8, 0, 0, Math.PI * 2);
      const gradient = this.ctx.createLinearGradient(-size, -size, size, size);
      gradient.addColorStop(0, "rgba(212, 175, 55, 0.6)");
      gradient.addColorStop(1, "rgba(251, 191, 36, 0.3)");
      this.ctx.fillStyle = gradient;
      this.ctx.fill();

      // String
      this.ctx.beginPath();
      this.ctx.moveTo(0, size * 0.8);
      this.ctx.quadraticCurveTo(size * 0.2, size * 1.2, size * 0.1, size * 1.5);
      this.ctx.strokeStyle = `rgba(212, 175, 55, ${opacity * 0.5})`;
      this.ctx.lineWidth = 2;
      this.ctx.stroke();

      this.ctx.restore();
    }

    drawFlower(x: number, y: number, size: number, rotation: number, opacity: number) {
      this.ctx.save();
      this.ctx.translate(x, y);
      this.ctx.rotate(rotation);
      this.ctx.globalAlpha = opacity;

      // Petals
      for (let i = 0; i < 6; i++) {
        this.ctx.save();
        this.ctx.rotate((Math.PI * 2 * i) / 6);
        this.ctx.beginPath();
        this.ctx.ellipse(size * 0.3, 0, size * 0.3, size * 0.15, 0, 0, Math.PI * 2);
        this.ctx.fillStyle = `rgba(212, 175, 55, ${opacity * 0.6})`;
        this.ctx.fill();
        this.ctx.restore();
      }

      // Center
      this.ctx.beginPath();
      this.ctx.arc(0, 0, size * 0.2, 0, Math.PI * 2);
      this.ctx.fillStyle = `rgba(251, 191, 36, ${opacity * 0.8})`;
      this.ctx.fill();

      this.ctx.restore();
    }

    drawStar(x: number, y: number, size: number, rotation: number, opacity: number) {
      this.ctx.save();
      this.ctx.translate(x, y);
      this.ctx.rotate(rotation);
      this.ctx.globalAlpha = opacity;

      this.ctx.beginPath();
      for (let i = 0; i < 5; i++) {
        const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
        const x1 = Math.cos(angle) * size;
        const y1 = Math.sin(angle) * size;
        const x2 = Math.cos(angle + Math.PI / 5) * (size * 0.4);
        const y2 = Math.sin(angle + Math.PI / 5) * (size * 0.4);

        if (i === 0) this.ctx.moveTo(x1, y1);
        else this.ctx.lineTo(x1, y1);
        this.ctx.lineTo(x2, y2);
      }
      this.ctx.closePath();
      this.ctx.fillStyle = `rgba(212, 175, 55, ${opacity * 0.5})`;
      this.ctx.fill();

      this.ctx.restore();
    }

    drawHeart(x: number, y: number, size: number, rotation: number, opacity: number) {
      this.ctx.save();
      this.ctx.translate(x, y);
      this.ctx.rotate(rotation);
      this.ctx.globalAlpha = opacity;

      this.ctx.beginPath();
      this.ctx.moveTo(0, size * 0.3);
      this.ctx.bezierCurveTo(-size * 0.5, -size * 0.3, -size, size * 0.1, 0, size * 0.8);
      this.ctx.bezierCurveTo(size, size * 0.1, size * 0.5, -size * 0.3, 0, size * 0.3);
      this.ctx.fillStyle = `rgba(212, 175, 55, ${opacity * 0.4})`;
      this.ctx.fill();

      this.ctx.restore();
    }

    drawDiamond(x: number, y: number, size: number, rotation: number, opacity: number) {
      this.ctx.save();
      this.ctx.translate(x, y);
      this.ctx.rotate(rotation);
      this.ctx.globalAlpha = opacity;

      this.ctx.beginPath();
      this.ctx.moveTo(0, -size);
      this.ctx.lineTo(size * 0.5, 0);
      this.ctx.lineTo(0, size);
      this.ctx.lineTo(-size * 0.5, 0);
      this.ctx.closePath();
      this.ctx.fillStyle = `rgba(212, 175, 55, ${opacity * 0.5})`;
      this.ctx.fill();

      this.ctx.restore();
    }

    animate() {
      this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

      this.elements.forEach((el) => {
        // Update position
        el.x += el.vx;
        el.y += el.vy;
        el.rotation += el.rotationSpeed;

        // Wrap around screen
        if (el.x < -50) el.x = this.canvas.width + 50;
        if (el.x > this.canvas.width + 50) el.x = -50;
        if (el.y < -50) el.y = this.canvas.height + 50;
        if (el.y > this.canvas.height + 50) el.y = -50;

        // Draw based on shape
        switch (el.shape) {
          case "balloon":
            this.drawBalloon(el.x, el.y, el.size, el.rotation, el.opacity);
            break;
          case "flower":
            this.drawFlower(el.x, el.y, el.size, el.rotation, el.opacity);
            break;
          case "star":
            this.drawStar(el.x, el.y, el.size, el.rotation, el.opacity);
            break;
          case "heart":
            this.drawHeart(el.x, el.y, el.size, el.rotation, el.opacity);
            break;
          case "diamond":
            this.drawDiamond(el.x, el.y, el.size, el.rotation, el.opacity);
            break;
        }
      });

      this.animationId = requestAnimationFrame(() => this.animate());
    }
  }

  interface DecoElement {
    x: number;
    y: number;
    size: number;
    rotation: number;
    rotationSpeed: number;
    vx: number;
    vy: number;
    shape: string;
    opacity: number;
    scale: number;
    targetScale: number;
  }

  // Initialize
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", () => {
      new DecorationScene("decoration-canvas");
    });
  } else {
    new DecorationScene("decoration-canvas");
  }

  // Mobile menu toggle
  function toggleMenu() {
    const menu = document.getElementById("mobile-menu");
    const body = document.body;
    if (!menu) return;

    if (menu.classList.contains("hidden")) {
      menu.classList.remove("hidden");
      setTimeout(() => menu.classList.remove("opacity-0"), 10);
      body.style.overflow = "hidden";
    } else {
      menu.classList.add("opacity-0");
      setTimeout(() => menu.classList.add("hidden"), 300);
      body.style.overflow = "";
    }
  }

  document
    .getElementById("mobile-menu-btn")
    ?.addEventListener("click", toggleMenu);
</script>

<style>
  @keyframes float-slow {
    0%, 100% {
      transform: translateY(0) translateX(0);
    }
    50% {
      transform: translateY(-20px) translateX(10px);
    }
  }

  @keyframes float-slower {
    0%, 100% {
      transform: translateY(0) translateX(0);
    }
    50% {
      transform: translateY(-30px) translateX(-15px);
    }
  }

  @keyframes float-medium {
    0%, 100% {
      transform: translateY(0) translateX(0);
    }
    50% {
      transform: translateY(-25px) translateX(12px);
    }
  }

  .animate-float-slow {
    animation: float-slow 8s ease-in-out infinite;
  }

  .animate-float-slower {
    animation: float-slower 12s ease-in-out infinite;
  }

  .animate-float-medium {
    animation: float-medium 10s ease-in-out infinite;
  }

  .glass {
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
</style>
