---
export interface Props {
  title: string;
  folder: string;
  count: number;
}

const { title, folder, count } = Astro.props;
---

<div class="px-4 md:px-10 py-6">
  <div class="columns-2 md:columns-3 lg:columns-4 gap-4 space-y-4">
    {
      Array.from({ length: count }, (_, i) => (
        <div
          class="break-inside-avoid relative group overflow-hidden rounded-xl cursor-pointer"
          onclick={`openLightbox('/${folder}/imagen-${i + 1}.jpg')`}
        >
          <img
            src={`/${folder}/imagen-${i + 1}.jpg`}
            alt={`Imagen ${i + 1}`}
            class="w-full h-auto object-cover transform transition duration-500 group-hover:scale-110"
            loading="lazy"
          />
          <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
            <span class="text-white text-3xl font-light">+</span>
          </div>
        </div>
      ))
    }
  </div>
</div>

<!-- Lightbox Modal -->
<div
  id="lightbox"
  class="fixed inset-0 z-50 bg-black/95 hidden flex justify-center items-center opacity-0 transition-opacity duration-300"
>
  <button
    class="absolute top-4 right-4 text-white hover:text-primary transition-colors focus:outline-none z-50 p-2"
    onclick="closeLightbox()"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="h-10 w-10"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M6 18L18 6M6 6l12 12"></path>
    </svg>
  </button>

  <img
    id="lightbox-img"
    src=""
    alt="Vista ampliada"
    class="max-h-[90vh] max-w-[90vw] object-contain shadow-2xl rounded-sm"
  />
</div>

<script is:inline>
  function openLightbox(src) {
    const lightbox = document.getElementById("lightbox");
    const img = document.getElementById("lightbox-img");
    const body = document.body;

    img.src = src;
    lightbox.classList.remove("hidden");
    // Timeout to allow display block to apply before opacity transition
    setTimeout(() => lightbox.classList.remove("opacity-0"), 10);
    body.style.overflow = "hidden"; // Prevent scrolling
  }

  function closeLightbox() {
    const lightbox = document.getElementById("lightbox");
    const body = document.body;

    lightbox.classList.add("opacity-0");
    setTimeout(() => {
      lightbox.classList.add("hidden");
      document.getElementById("lightbox-img").src = "";
    }, 300);
    body.style.overflow = "";
  }

  // Close on background click
  document.getElementById("lightbox").addEventListener("click", (e) => {
    if (e.target.id === "lightbox") {
      closeLightbox();
    }
  });

  // Close on Escape key
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      closeLightbox();
    }
  });
</script>
