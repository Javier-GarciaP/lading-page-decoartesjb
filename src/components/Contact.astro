---
import Instagram from "./icons/Instagram.astro";
import Whatsapp from "./icons/Whatsapp.astro";
import Section from "./Section.astro";
---

<Section id="contact">
  <section class="max-w-6xl mx-auto px-6 py-12">
    <div class="grid lg:grid-cols-2 gap-12 items-start">
      {/* Narrative & Info Section - Redesigned */}
      <div class="space-y-6 animate-fade-in-up">
        {/* Header */}
        <div class="space-y-4">
          <div
            class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-primary/10 border border-primary/20 backdrop-blur-sm"
          >
            <svg
              class="w-4 h-4 text-primary"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"
              ></path>
              <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"
              ></path>
            </svg>
            <span
              class="text-sm font-semibold text-primary uppercase tracking-wider"
              >Cont√°ctanos</span
            >
          </div>

          <h2
            class="text-3xl md:text-4xl lg:text-5xl font-heading font-bold text-white leading-tight"
          >
            Hagamos Realidad tu
            <span
              class="block mt-2 bg-gradient-to-r from-primary via-amber-300 to-primary bg-clip-text text-transparent animate-gradient"
            >
              Evento So√±ado
            </span>
          </h2>

          <p
            class="text-lg md:text-xl text-secondary/90 max-w-lg leading-relaxed"
          >
            Cada detalle cuenta. Desde la primera consulta hasta el √∫ltimo
            adorno,
            <span class="text-white font-semibold"
              >transformamos tus ideas en experiencias inolvidables</span
            >.
          </p>
        </div>

        {/* Contact Cards */}
        <div class="grid sm:grid-cols-2 gap-4">
          {/* WhatsApp Card - Clickeable */}
          <a
            href="https://wa.me/56937708933?text=Hola%20Decoartesjb!%20Me%20gustar√≠a%20cotizar%20una%20decoraci√≥n%20para%20mi%20evento."
            target="_blank"
            rel="noopener noreferrer"
            class="group relative p-5 rounded-2xl bg-gradient-to-br from-green-500/10 via-bg-secondary to-bg-secondary border border-green-500/20 hover:border-green-500/50 backdrop-blur-sm transition-all duration-300 hover:scale-[1.02] hover:shadow-2xl hover:shadow-green-500/20"
          >
            {/* Glow Effect */}
            <div
              class="absolute inset-0 rounded-2xl bg-gradient-to-br from-green-500/0 via-green-500/5 to-green-500/0 opacity-0 group-hover:opacity-100 transition-opacity duration-300"
            >
            </div>

            <div class="relative flex items-center gap-4">
              <div class="relative">
                <div
                  class="absolute inset-0 bg-green-500/30 blur-xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity"
                >
                </div>
                <div
                  class="relative w-14 h-14 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center text-white shadow-lg group-hover:scale-110 transition-transform"
                >
                  <Whatsapp />
                </div>
              </div>

              <div class="flex-1">
                <p
                  class="text-xs font-bold text-green-400 uppercase tracking-wider mb-1 flex items-center gap-1"
                >
                  WhatsApp
                  <svg
                    class="w-3 h-3 opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                  </svg>
                </p>
                <p class="text-white font-bold text-lg">+56 9 3770 8933</p>
                <p class="text-xs text-green-400/70 mt-1">
                  Click para chatear ‚Üí
                </p>
              </div>
            </div>
          </a>

          {/* Instagram Card */}
          <a
            href="https://www.instagram.com/decoartesjb"
            target="_blank"
            rel="noopener noreferrer"
            class="group relative p-5 rounded-2xl bg-gradient-to-br from-pink-500/10 via-bg-secondary to-bg-secondary border border-pink-500/20 hover:border-pink-500/50 backdrop-blur-sm transition-all duration-300 hover:scale-[1.02] hover:shadow-2xl hover:shadow-pink-500/20"
          >
            {/* Glow Effect */}
            <div
              class="absolute inset-0 rounded-2xl bg-gradient-to-br from-pink-500/0 via-pink-500/5 to-pink-500/0 opacity-0 group-hover:opacity-100 transition-opacity duration-300"
            >
            </div>

            <div class="relative flex items-center gap-4">
              <div class="relative">
                <div
                  class="absolute inset-0 bg-pink-500/30 blur-xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity"
                >
                </div>
                <div
                  class="relative w-14 h-14 bg-gradient-to-br from-pink-500 to-rose-600 rounded-xl flex items-center justify-center text-white shadow-lg group-hover:scale-110 transition-transform"
                >
                  <Instagram />
                </div>
              </div>

              <div class="flex-1">
                <p
                  class="text-xs font-bold text-pink-400 uppercase tracking-wider mb-1 flex items-center gap-1"
                >
                  Instagram
                  <svg
                    class="w-3 h-3 opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                  </svg>
                </p>
                <p class="text-white font-bold text-lg">@decoartesjb</p>
                <p class="text-xs text-pink-400/70 mt-1">
                  Ver nuestro portafolio ‚Üí
                </p>
              </div>
            </div>
          </a>
        </div>

        {/* Stats/Benefits Cards */}
        <div class="grid grid-cols-3 gap-3">
          <div
            class="p-4 rounded-xl bg-white/5 border border-white/10 backdrop-blur-sm hover:bg-white/10 transition-colors group"
          >
            <div class="flex flex-col items-center text-center gap-2">
              <div
                class="w-10 h-10 rounded-lg bg-primary/20 flex items-center justify-center text-primary group-hover:scale-110 transition-transform"
              >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <div>
                <p class="text-2xl font-bold text-white">24h</p>
                <p class="text-xs text-secondary">Respuesta</p>
              </div>
            </div>
          </div>

          <div
            class="p-4 rounded-xl bg-white/5 border border-white/10 backdrop-blur-sm hover:bg-white/10 transition-colors group"
          >
            <div class="flex flex-col items-center text-center gap-2">
              <div
                class="w-10 h-10 rounded-lg bg-primary/20 flex items-center justify-center text-primary group-hover:scale-110 transition-transform"
              >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"></path>
                </svg>
              </div>
              <div>
                <p class="text-2xl font-bold text-white">100%</p>
                <p class="text-xs text-secondary">Dedicaci√≥n</p>
              </div>
            </div>
          </div>

          <div
            class="p-4 rounded-xl bg-white/5 border border-white/10 backdrop-blur-sm hover:bg-white/10 transition-colors group"
          >
            <div class="flex flex-col items-center text-center gap-2">
              <div
                class="w-10 h-10 rounded-lg bg-primary/20 flex items-center justify-center text-primary group-hover:scale-110 transition-transform"
              >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <div>
                <p class="text-2xl font-bold text-white">‚àû</p>
                <p class="text-xs text-secondary">Creatividad</p>
              </div>
            </div>
          </div>
        </div>

        {/* Quote Card */}
        <div
          class="relative p-6 rounded-2xl border border-primary/20 bg-gradient-to-br from-primary/5 via-transparent to-transparent backdrop-blur-sm overflow-hidden group"
        >
          {/* Decorative Elements */}
          <div
            class="absolute top-0 right-0 w-32 h-32 bg-primary/10 blur-3xl rounded-full -z-10"
          >
          </div>
          <div
            class="absolute -bottom-8 -left-8 w-24 h-24 bg-amber-500/10 blur-2xl rounded-full -z-10"
          >
          </div>

          {/* Quote Icon */}
          <div
            class="absolute top-4 right-4 opacity-10 group-hover:opacity-20 transition-opacity"
          >
            <svg
              class="w-16 h-16 text-primary"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"
              ></path>
            </svg>
          </div>

          <div class="relative">
            <p
              class="text-white/90 italic text-lg md:text-xl leading-relaxed mb-4 font-light"
            >
              "Los detalles no son detalles. Son los que marcan la diferencia."
            </p>
            <div class="flex items-center gap-3">
              <div
                class="h-px flex-1 bg-gradient-to-r from-primary/50 to-transparent"
              >
              </div>
              <span class="text-sm font-semibold text-primary"
                >Nuestra Filosof√≠a</span
              >
            </div>
          </div>
        </div>
      </div>

      {/* Modern Form */}
      <div
        class="glass-card p-6 md:p-8 rounded-2xl relative overflow-hidden animate-fade-in-up delay-150"
      >
        <div
          class="absolute top-0 right-0 w-64 h-64 bg-primary/10 blur-[80px] -z-10 rounded-full pointer-events-none"
        >
        </div>

        <form id="event-form" class="space-y-6">
          <!-- Informaci√≥n Personal -->
          <div class="space-y-4">
            <h3
              class="text-sm font-bold text-primary uppercase tracking-wider flex items-center gap-2"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                ></path>
              </svg>
              Informaci√≥n Personal
            </h3>

            <div class="grid md:grid-cols-2 gap-4">
              <div class="space-y-2">
                <label
                  class="text-xs font-semibold text-secondary uppercase ml-1 flex items-center gap-1"
                >
                  Nombre Completo <span class="text-primary">*</span>
                </label>
                <input
                  type="text"
                  name="nombre"
                  placeholder="Ej. Mar√≠a Jos√© Gonz√°lez"
                  required
                  class="w-full bg-bg-secondary border border-white/10 rounded-lg px-4 py-3.5 text-white placeholder:text-white/30 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all"
                />
              </div>

              <div class="space-y-2">
                <label
                  class="text-xs font-semibold text-secondary uppercase ml-1 flex items-center gap-1"
                >
                  Email <span class="text-primary">*</span>
                </label>
                <input
                  type="email"
                  name="email"
                  placeholder="maria@ejemplo.com"
                  required
                  class="w-full bg-bg-secondary border border-white/10 rounded-lg px-4 py-3.5 text-white placeholder:text-white/30 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all"
                />
              </div>
            </div>

            <div class="grid md:grid-cols-2 gap-4">
              <div class="space-y-2">
                <label
                  class="text-xs font-semibold text-secondary uppercase ml-1 flex items-center gap-1"
                >
                  Tel√©fono <span class="text-primary">*</span>
                </label>
                <input
                  type="tel"
                  name="telefono"
                  placeholder="+56 9 1234 5678"
                  required
                  class="w-full bg-bg-secondary border border-white/10 rounded-lg px-4 py-3.5 text-white placeholder:text-white/30 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all"
                />
              </div>

              <div class="space-y-2">
                <label
                  class="text-xs font-semibold text-secondary uppercase ml-1 flex items-center gap-1"
                >
                  Ubicaci√≥n del Evento <span class="text-primary">*</span>
                </label>
                <input
                  type="text"
                  name="ubicacion"
                  placeholder="Santiago, Las Condes"
                  required
                  class="w-full bg-bg-secondary border border-white/10 rounded-lg px-4 py-3.5 text-white placeholder:text-white/30 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all"
                />
              </div>
            </div>
          </div>

          <!-- Detalles del Evento -->
          <div class="space-y-4 pt-2 border-t border-white/5">
            <h3
              class="text-sm font-bold text-primary uppercase tracking-wider flex items-center gap-2"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                ></path>
              </svg>
              Detalles del Evento
            </h3>

            <div class="grid md:grid-cols-2 gap-4">
              <div class="space-y-2">
                <label
                  class="text-xs font-semibold text-secondary uppercase ml-1 flex items-center gap-1"
                >
                  Tipo de Evento <span class="text-primary">*</span>
                </label>
                <select
                  name="tipoEvento"
                  required
                  class="w-full bg-bg-secondary border border-white/10 rounded-lg px-4 py-3.5 text-white focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all appearance-none cursor-pointer"
                  style="background-image: url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 fill=%22none%22 viewBox=%220 0 24 24%22 stroke=%22%23D4AF37%22%3E%3Cpath stroke-linecap=%22round%22 stroke-linejoin=%22round%22 stroke-width=%222%22 d=%22M19 9l-7 7-7-7%22/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1.5em 1.5em; padding-right: 2.5rem;"
                >
                  <option value="">Selecciona un tipo</option>
                  <option value="Boda">üíç Boda</option>
                  <option value="Cumplea√±os Infantil"
                    >üéà Cumplea√±os Infantil</option
                  >
                  <option value="Cumplea√±os Adulto">üéÇ Cumplea√±os Adulto</option
                  >
                  <option value="Baby Shower">üë∂ Baby Shower</option>
                  <option value="Evento Corporativo"
                    >üè¢ Evento Corporativo</option
                  >
                  <option value="Quincea√±era">üëë Quincea√±era</option>
                  <option value="Aniversario">üíê Aniversario</option>
                  <option value="Graduaci√≥n">üéì Graduaci√≥n</option>
                  <option value="Otro">‚ú® Otro</option>
                </select>
              </div>

              <div class="space-y-2">
                <label
                  class="text-xs font-semibold text-secondary uppercase ml-1 flex items-center gap-1"
                >
                  Fecha del Evento <span class="text-primary">*</span>
                </label>
                <input
                  type="date"
                  name="fechaEvento"
                  required
                  class="w-full bg-bg-secondary border border-white/10 rounded-lg px-4 py-3.5 text-white focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all"
                />
              </div>
            </div>

            <div class="grid md:grid-cols-2 gap-4">
              <div class="space-y-2">
                <label
                  class="text-xs font-semibold text-secondary uppercase ml-1"
                >
                  N√∫mero de Invitados (aprox.)
                </label>
                <input
                  type="number"
                  name="invitados"
                  placeholder="Ej. 50"
                  min="1"
                  class="w-full bg-bg-secondary border border-white/10 rounded-lg px-4 py-3.5 text-white placeholder:text-white/30 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all"
                />
              </div>

              <div class="space-y-2">
                <label
                  class="text-xs font-semibold text-secondary uppercase ml-1"
                >
                  Presupuesto Aproximado
                </label>
                <select
                  name="presupuesto"
                  class="w-full bg-bg-secondary border border-white/10 rounded-lg px-4 py-3.5 text-white focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all appearance-none cursor-pointer"
                  style="background-image: url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 fill=%22none%22 viewBox=%220 0 24 24%22 stroke=%22%23D4AF37%22%3E%3Cpath stroke-linecap=%22round%22 stroke-linejoin=%22round%22 stroke-width=%222%22 d=%22M19 9l-7 7-7-7%22/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1.5em 1.5em; padding-right: 2.5rem;"
                >
                  <option value="">Selecciona un rango</option>
                  <option value="Menos de $200.000">Menos de $200.000</option>
                  <option value="$200.000 - $500.000"
                    >$200.000 - $500.000</option
                  >
                  <option value="$500.000 - $1.000.000"
                    >$500.000 - $1.000.000</option
                  >
                  <option value="$1.000.000 - $2.000.000"
                    >$1.000.000 - $2.000.000</option
                  >
                  <option value="M√°s de $2.000.000">M√°s de $2.000.000</option>
                  <option value="Por definir">Por definir</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Mensaje -->
          <div class="space-y-2 pt-2">
            <label
              class="text-xs font-semibold text-secondary uppercase ml-1 flex items-center gap-1"
            >
              Cu√©ntanos tu Visi√≥n <span class="text-primary">*</span>
            </label>
            <textarea
              name="mensaje"
              placeholder="Describe tu evento ideal: colores preferidos, tem√°tica, estilo, elementos especiales que te gustar√≠a incluir..."
              required
              rows="5"
              class="w-full bg-bg-secondary border border-white/10 rounded-lg px-4 py-3.5 text-white placeholder:text-white/30 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all resize-none"
            ></textarea>
            <p class="text-xs text-secondary/60 ml-1 flex items-center gap-1">
              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path
                  fill-rule="evenodd"
                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                  clip-rule="evenodd"></path>
              </svg>
              Mientras m√°s detalles compartas, mejor podremos ayudarte a crear tu
              evento perfecto
            </p>
          </div>

          <!-- Submit Button -->
          <div class="pt-2">
            <button
              id="submit-btn"
              type="submit"
              class="group relative w-full bg-gradient-to-r from-primary to-amber-400 text-bg font-bold text-lg py-4 rounded-xl hover:shadow-2xl hover:shadow-primary/50 transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] overflow-hidden"
            >
              <span
                class="relative z-10 flex items-center justify-center gap-2"
              >
                <svg
                  class="w-5 h-5 group-hover:rotate-12 transition-transform"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                </svg>
                SOLICITAR CONSULTA GRATUITA
              </span>
              <div
                class="absolute inset-0 bg-gradient-to-r from-amber-400 to-primary opacity-0 group-hover:opacity-100 transition-opacity duration-300"
              >
              </div>
            </button>
            <p class="text-center text-xs text-secondary/60 mt-3">
              üìû Respuesta en menos de 24 horas
            </p>
          </div>

          <!-- Status Message -->
          <div
            id="status-msg"
            class="hidden text-center text-sm p-4 rounded-xl font-medium"
          >
          </div>
        </form>
      </div>
    </div>
  </section>
</Section>

<script>
  import confetti from "canvas-confetti";

  const form = document.getElementById("event-form") as HTMLFormElement;
  const submitBtn = document.getElementById("submit-btn") as HTMLButtonElement;
  const statusMsg = document.getElementById("status-msg") as HTMLDivElement;

  const showStatus = (text: string, isError = false) => {
    statusMsg.textContent = text;
    statusMsg.className = `text-center text-sm p-3 rounded-lg font-medium ${
      isError ? "bg-red-500/20 text-red-200" : "bg-green-500/20 text-green-200"
    }`;
    statusMsg.classList.remove("hidden");
  };

  const fireConfetti = () => {
    const duration = 3 * 1000;
    const animationEnd = Date.now() + duration;
    const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
    const randomInRange = (min: number, max: number) =>
      Math.random() * (max - min) + min;

    const interval: any = setInterval(function () {
      const timeLeft = animationEnd - Date.now();
      if (timeLeft <= 0) return clearInterval(interval);
      const particleCount = 50 * (timeLeft / duration);
      confetti({
        ...defaults,
        particleCount,
        origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },
      });
      confetti({
        ...defaults,
        particleCount,
        origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },
      });
    }, 250);
  };

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    submitBtn.disabled = true;
    const originalText = submitBtn.textContent;
    submitBtn.textContent = "ENVIANDO...";
    statusMsg.classList.add("hidden");

    const formData = new FormData(form);
    const data = Object.fromEntries(formData);

    try {
      const response = await fetch("/api/send-email", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      if (response.ok) {
        showStatus("¬°Recibido! Te contactaremos pronto.");
        fireConfetti();
        form.reset();
      } else {
        showStatus("Error al enviar. Intenta nuevamente.", true);
      }
    } catch {
      showStatus("Error de conexi√≥n.", true);
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
    }
  });
</script>
