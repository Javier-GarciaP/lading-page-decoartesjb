---
import Instagram from "./icons/Instagram.astro";
import Whasapp from "./icons/Whasapp.astro";
import Section from "./Section.astro";
---

<Section id="contact">
  <section class="max-w-7xl mx-auto px-6 py-20">
    <div class="grid lg:grid-cols-2 gap-16 items-start">
      <!-- Info Column -->
      <div class="space-y-8">
        <div>
          <h2
            class="text-5xl md:text-6xl font-heading font-black text-white mb-6 leading-tight"
          >
            Diseñemos <span class="text-primary italic">Momentos</span> Inolvidables
          </h2>
          <p class="text-xl text-zinc-400 max-w-lg leading-relaxed">
            Desde bodas íntimas hasta producciones corporativas de gran escala.
            Cuéntanos tu visión y nosotros nos encargaremos de la magia.
          </p>
        </div>

        <div class="grid sm:grid-cols-2 gap-6">
          <div
            class="p-6 bg-white/5 rounded-3xl border border-white/10 group hover:bg-primary/10 hover:border-primary/30 transition-all duration-500"
          >
            <div
              class="w-12 h-12 bg-primary/20 rounded-2xl flex items-center justify-center text-primary mb-4 group-hover:scale-110 transition-transform duration-500"
            >
              <Whasapp />
            </div>
            <h4 class="text-white font-bold text-lg mb-1">Escríbenos</h4>
            <p class="text-zinc-400">+56 9 3770 8933</p>
          </div>

          <a
            href="https://www.instagram.com/decoartesjb"
            target="_blank"
            class="p-6 bg-white/5 rounded-3xl border border-white/10 group hover:bg-pink-500/10 hover:border-pink-500/30 transition-all duration-500"
          >
            <div
              class="w-12 h-12 bg-pink-500/20 rounded-2xl flex items-center justify-center text-pink-500 mb-4 group-hover:scale-110 transition-transform duration-500"
            >
              <Instagram />
            </div>
            <h4 class="text-white font-bold text-lg mb-1">Síguenos</h4>
            <p class="text-zinc-400">@decoartesjb</p>
          </a>
        </div>

        <div class="p-8 bg-zinc-900/50 rounded-3xl border border-zinc-800">
          <p
            class="text-zinc-500 font-medium uppercase tracking-widest text-xs mb-4"
          >
            Nuestros Clientes Dicen
          </p>
          <p class="text-white text-lg italic leading-relaxed">
            "Superaron todas nuestras expectativas. La atención al detalle y la
            elegancia que aportaron a nuestra boda fue simplemente
            espectacular."
          </p>
          <div class="mt-6 flex items-center gap-4">
            <div class="w-10 h-10 bg-primary/30 rounded-full"></div>
            <div>
              <p class="text-white font-bold text-sm">Carolina & Andrés</p>
              <p class="text-primary text-xs font-medium">Boda en Santiago</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Column -->
      <div
        class="bg-zinc-950 p-8 md:p-12 rounded-[2.5rem] border border-white/10 shadow-2xl relative overflow-hidden"
      >
        <div
          class="absolute top-0 right-0 w-64 h-64 bg-primary/10 blur-[100px] -z-10"
        >
        </div>

        <form id="event-form" class="space-y-6">
          <div class="grid md:grid-cols-2 gap-6">
            <div class="space-y-2">
              <label class="text-sm font-bold text-zinc-400 ml-1"
                >Tu Nombre</label
              >
              <input
                type="text"
                name="nombre"
                placeholder="Ej. Javier García"
                required
                class="w-full bg-zinc-900 border border-zinc-800 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-300"
              />
            </div>
            <div class="space-y-2">
              <label class="text-sm font-bold text-zinc-400 ml-1">Email</label>
              <input
                type="email"
                name="email"
                placeholder="hola@tuempresa.com"
                required
                class="w-full bg-zinc-900 border border-zinc-800 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-300"
              />
            </div>
          </div>

          <div class="grid md:grid-cols-2 gap-6">
            <div class="space-y-2">
              <label class="text-sm font-bold text-zinc-400 ml-1"
                >Tipo de Evento</label
              >
              <select
                name="tipoEvento"
                class="w-full bg-zinc-900 border border-zinc-800 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary appearance-none transition-all duration-300"
              >
                <option value="Boda">Boda de Ensueño</option>
                <option value="Corporativo">Evento Corporativo</option>
                <option value="Cumpleaños">Cumpleaños de Gala</option>
                <option value="Aniversario">Aniversario Especial</option>
                <option value="Otro">Otro Tipo de Evento</option>
              </select>
            </div>
            <div class="space-y-2">
              <label class="text-sm font-bold text-zinc-400 ml-1"
                >Fecha Prevista</label
              >
              <input
                type="date"
                name="fechaEvento"
                class="w-full bg-zinc-900 border border-zinc-800 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-300"
              />
            </div>
          </div>

          <div class="grid md:grid-cols-2 gap-6">
            <div class="space-y-2">
              <label class="text-sm font-bold text-zinc-400 ml-1"
                >Presupuesto Estimado</label
              >
              <select
                name="presupuesto"
                class="w-full bg-zinc-900 border border-zinc-800 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary appearance-none transition-all duration-300"
              >
                <option value="Básico">Básico</option>
                <option value="Estándar">Estándar</option>
                <option value="Premium">Premium / LUJO</option>
                <option value="Sin definir">Aún no lo tengo definido</option>
              </select>
            </div>
            <div class="space-y-2">
              <label class="text-sm font-bold text-zinc-400 ml-1"
                >Nº Estimado de Invitados</label
              >
              <input
                type="number"
                name="invitados"
                placeholder="100"
                class="w-full bg-zinc-900 border border-zinc-800 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-300"
              />
            </div>
          </div>

          <div class="space-y-2">
            <label class="text-sm font-bold text-zinc-400 ml-1"
              >Cuéntanos tu Visión</label
            >
            <textarea
              name="mensaje"
              placeholder="Queremos que nuestro evento sea..."
              required
              class="w-full bg-zinc-900 border border-zinc-800 rounded-2xl px-5 py-4 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary min-h-[120px] resize-none transition-all duration-300"
            ></textarea>
          </div>

          <button
            id="submit-btn"
            type="submit"
            class="w-full bg-primary hover:bg-white text-zinc-950 font-black text-lg py-5 rounded-2xl shadow-[0_0_30px_-5px_var(--color-primary)] hover:shadow-white/20 transition-all duration-500 transform hover:-translate-y-1 active:scale-[0.98]"
          >
            SOLICITAR CONSULTA PERSONALIZADA
          </button>

          <div
            id="status-msg"
            class="hidden text-center p-4 rounded-xl font-bold transition-all duration-300 scale-95 opacity-0"
          >
          </div>
        </form>
      </div>
    </div>
  </section>
</Section>

<script>
  import confetti from "canvas-confetti";

  const form = document.getElementById("event-form") as HTMLFormElement;
  const submitBtn = document.getElementById("submit-btn") as HTMLButtonElement;
  const statusMsg = document.getElementById("status-msg") as HTMLDivElement;

  const showStatus = (text: string, isError = false) => {
    statusMsg.textContent = text;
    statusMsg.className = `p-4 rounded-xl font-bold transition-all duration-300 ${
      isError
        ? "bg-red-500/10 text-red-500 border border-red-500/20"
        : "bg-green-500/10 text-green-500 border border-green-500/20"
    }`;
    statusMsg.classList.remove("hidden", "scale-95", "opacity-0");
    statusMsg.classList.add("scale-100", "opacity-100");
  };

  const fireConfetti = () => {
    const duration = 3 * 1000;
    const animationEnd = Date.now() + duration;
    const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

    const randomInRange = (min: number, max: number) =>
      Math.random() * (max - min) + min;

    const interval: any = setInterval(function () {
      const timeLeft = animationEnd - Date.now();

      if (timeLeft <= 0) {
        return clearInterval(interval);
      }

      const particleCount = 50 * (timeLeft / duration);
      confetti({
        ...defaults,
        particleCount,
        origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },
      });
      confetti({
        ...defaults,
        particleCount,
        origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },
      });
    }, 250);
  };

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();

    submitBtn.disabled = true;
    const originalText = submitBtn.textContent;
    submitBtn.textContent = "PROCESANDO TU VISIÓN...";
    statusMsg.classList.add("hidden");

    const formData = new FormData(form);
    const data = Object.fromEntries(formData);

    try {
      const response = await fetch("/api/send-email", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      if (response.ok) {
        showStatus(
          "✨ ¡Mensaje recibido! Nos pondremos en contacto pronto con usted para crear su evento ideal.",
        );
        fireConfetti();
        form.reset();
      } else {
        const err = await response.json();
        showStatus(
          `Error: ${err.error || "No se pudo enviar el mensaje"}`,
          true,
        );
      }
    } catch (error) {
      showStatus(
        "⚠️ Error de conexión. Por favor, verifica tu internet.",
        true,
      );
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
    }
  });
</script>
